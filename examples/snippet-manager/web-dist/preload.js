var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},T={},J={},S={};(function(i){var e=h&&h.__extends||function(){var u=function(f,v){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,g){m.__proto__=g}||function(m,g){for(var R in g)Object.prototype.hasOwnProperty.call(g,R)&&(m[R]=g[R])},u(f,v)};return function(f,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");u(f,v);function m(){this.constructor=f}f.prototype=v===null?Object.create(v):(m.prototype=v.prototype,new m)}}();Object.defineProperty(i,"__esModule",{value:!0}),i.createJSONRPCNotification=i.createJSONRPCRequest=i.createJSONRPCSuccessResponse=i.createJSONRPCErrorResponse=i.JSONRPCErrorCode=i.JSONRPCErrorException=i.isJSONRPCResponses=i.isJSONRPCResponse=i.isJSONRPCRequests=i.isJSONRPCRequest=i.isJSONRPCID=i.JSONRPC=void 0,i.JSONRPC="2.0";var t=function(u){return typeof u=="string"||typeof u=="number"||u===null};i.isJSONRPCID=t;var r=function(u){return u.jsonrpc===i.JSONRPC&&u.method!==void 0&&u.result===void 0&&u.error===void 0};i.isJSONRPCRequest=r;var s=function(u){return Array.isArray(u)&&u.every(i.isJSONRPCRequest)};i.isJSONRPCRequests=s;var n=function(u){return u.jsonrpc===i.JSONRPC&&u.id!==void 0&&(u.result!==void 0||u.error!==void 0)};i.isJSONRPCResponse=n;var c=function(u){return Array.isArray(u)&&u.every(i.isJSONRPCResponse)};i.isJSONRPCResponses=c;var a=function(u,f,v){var m={code:u,message:f};return v!=null&&(m.data=v),m},d=function(u){e(f,u);function f(v,m,g){var R=u.call(this,v)||this;return Object.setPrototypeOf(R,f.prototype),R.code=m,R.data=g,R}return f.prototype.toObject=function(){return a(this.code,this.message,this.data)},f}(Error);i.JSONRPCErrorException=d,function(u){u[u.ParseError=-32700]="ParseError",u[u.InvalidRequest=-32600]="InvalidRequest",u[u.MethodNotFound=-32601]="MethodNotFound",u[u.InvalidParams=-32602]="InvalidParams",u[u.InternalError=-32603]="InternalError"}(i.JSONRPCErrorCode||(i.JSONRPCErrorCode={}));var o=function(u,f,v,m){return{jsonrpc:i.JSONRPC,id:u,error:a(f,v,m)}};i.createJSONRPCErrorResponse=o;var l=function(u,f){return{jsonrpc:i.JSONRPC,id:u,result:f??null}};i.createJSONRPCSuccessResponse=l;var p=function(u,f,v){return{jsonrpc:i.JSONRPC,id:u,method:f,params:v}};i.createJSONRPCRequest=p;var F=function(u,f){return{jsonrpc:i.JSONRPC,method:u,params:f}};i.createJSONRPCNotification=F})(S);var C={};Object.defineProperty(C,"__esModule",{value:!0});C.DefaultErrorCode=void 0;C.DefaultErrorCode=0;var A=h&&h.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function a(l){try{o(r.next(l))}catch(p){c(p)}}function d(l){try{o(r.throw(l))}catch(p){c(p)}}function o(l){l.done?n(l.value):s(l.value).then(a,d)}o((r=r.apply(i,e||[])).next())})},k=h&&h.__generator||function(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(o){return function(l){return d([o,l])}}function d(o){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,o[0]&&(t=0)),t;)try{if(r=1,s&&(n=o[0]&2?s.return:o[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,o[1])).done)return n;switch(s=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,s=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){t.label=o[1];break}if(o[0]===6&&t.label<n[1]){t.label=n[1],n=o;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(o);break}n[2]&&t.ops.pop(),t.trys.pop();continue}o=e.call(i,t)}catch(l){o=[6,l],s=0}finally{r=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(J,"__esModule",{value:!0});J.JSONRPCClient=void 0;var P=S,M=C,q=function(){function i(e,t){this._send=e,this.createID=t,this.idToResolveMap=new Map,this.id=0}return i.prototype._createID=function(){return this.createID?this.createID():++this.id},i.prototype.timeout=function(e,t){var r=this;t===void 0&&(t=function(c){return(0,P.createJSONRPCErrorResponse)(c,M.DefaultErrorCode,"Request timeout")});var s=function(c,a){var d=setTimeout(function(){c.forEach(function(o){var l=r.idToResolveMap.get(o);l&&(r.idToResolveMap.delete(o),l(t(o)))})},e);return a().then(function(o){return clearTimeout(d),o},function(o){return clearTimeout(d),Promise.reject(o)})},n=function(c,a){var d=(Array.isArray(c)?c:[c]).map(function(o){return o.id}).filter(I);return s(d,function(){return r.requestAdvanced(c,a)})};return{request:function(c,a,d){var o=r._createID();return s([o],function(){return r.requestWithID(c,a,d,o)})},requestAdvanced:function(c,a){return n(c,a)}}},i.prototype.request=function(e,t,r){return this.requestWithID(e,t,r,this._createID())},i.prototype.requestWithID=function(e,t,r,s){return A(this,void 0,void 0,function(){var n,c;return k(this,function(a){switch(a.label){case 0:return n=(0,P.createJSONRPCRequest)(s,e,t),[4,this.requestAdvanced(n,r)];case 1:return c=a.sent(),c.result!==void 0&&!c.error?[2,c.result]:c.result===void 0&&c.error?[2,Promise.reject(new P.JSONRPCErrorException(c.error.message,c.error.code,c.error.data))]:[2,Promise.reject(new Error("An unexpected error occurred"))]}})})},i.prototype.requestAdvanced=function(e,t){var r=this,s=Array.isArray(e);Array.isArray(e)||(e=[e]);var n=e.filter(function(d){return I(d.id)}),c=n.map(function(d){return new Promise(function(o){return r.idToResolveMap.set(d.id,o)})}),a=Promise.all(c).then(function(d){return s||!d.length?d:d[0]});return this.send(s?e:e[0],t).then(function(){return a},function(d){return n.forEach(function(o){r.receive((0,P.createJSONRPCErrorResponse)(o.id,M.DefaultErrorCode,d&&d.message||"Failed to send a request"))}),a})},i.prototype.notify=function(e,t,r){var s=(0,P.createJSONRPCNotification)(e,t);this.send(s,r).then(void 0,function(){})},i.prototype.send=function(e,t){return A(this,void 0,void 0,function(){return k(this,function(r){return[2,this._send(e,t)]})})},i.prototype.rejectAllPendingRequests=function(e){this.idToResolveMap.forEach(function(t,r){return t((0,P.createJSONRPCErrorResponse)(r,M.DefaultErrorCode,e))}),this.idToResolveMap.clear()},i.prototype.receive=function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach(function(r){var s=t.idToResolveMap.get(r.id);s&&(t.idToResolveMap.delete(r.id),s(r))})},i}();J.JSONRPCClient=q;var I=function(i){return i!=null},j={};Object.defineProperty(j,"__esModule",{value:!0});var _={},N=h&&h.__assign||function(){return N=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},N.apply(this,arguments)},x=h&&h.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function a(l){try{o(r.next(l))}catch(p){c(p)}}function d(l){try{o(r.throw(l))}catch(p){c(p)}}function o(l){l.done?n(l.value):s(l.value).then(a,d)}o((r=r.apply(i,e||[])).next())})},D=h&&h.__generator||function(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(o){return function(l){return d([o,l])}}function d(o){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,o[0]&&(t=0)),t;)try{if(r=1,s&&(n=o[0]&2?s.return:o[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,o[1])).done)return n;switch(s=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,s=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){t.label=o[1];break}if(o[0]===6&&t.label<n[1]){t.label=n[1],n=o;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(o);break}n[2]&&t.ops.pop(),t.trys.pop();continue}o=e.call(i,t)}catch(l){o=[6,l],s=0}finally{r=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},W=h&&h.__spreadArray||function(i,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,n;r<s;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return i.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(_,"__esModule",{value:!0});_.JSONRPCServer=void 0;var y=S,L=C,B=function(){return(0,y.createJSONRPCErrorResponse)(null,y.JSONRPCErrorCode.ParseError,"Parse error")},H=function(i){return(0,y.createJSONRPCErrorResponse)((0,y.isJSONRPCID)(i.id)?i.id:null,y.JSONRPCErrorCode.InvalidRequest,"Invalid Request")},Q=function(i){return(0,y.createJSONRPCErrorResponse)(i,y.JSONRPCErrorCode.MethodNotFound,"Method not found")},z=function(){function i(e){e===void 0&&(e={});var t;this.mapErrorToJSONRPCErrorResponse=V,this.nameToMethodDictionary={},this.middleware=null,this.errorListener=(t=e.errorListener)!==null&&t!==void 0?t:console.warn}return i.prototype.hasMethod=function(e){return!!this.nameToMethodDictionary[e]},i.prototype.addMethod=function(e,t){this.addMethodAdvanced(e,this.toJSONRPCMethod(t))},i.prototype.removeMethod=function(e){delete this.nameToMethodDictionary[e]},i.prototype.toJSONRPCMethod=function(e){return function(t,r){var s=e(t.params,r);return Promise.resolve(s).then(function(n){return U(t.id,n)})}},i.prototype.addMethodAdvanced=function(e,t){var r;this.nameToMethodDictionary=N(N({},this.nameToMethodDictionary),(r={},r[e]=t,r))},i.prototype.receiveJSON=function(e,t){var r=this.tryParseRequestJSON(e);return r?this.receive(r,t):Promise.resolve(B())},i.prototype.tryParseRequestJSON=function(e){try{return JSON.parse(e)}catch{return null}},i.prototype.receive=function(e,t){return Array.isArray(e)?this.receiveMultiple(e,t):this.receiveSingle(e,t)},i.prototype.receiveMultiple=function(e,t){return x(this,void 0,void 0,function(){var r,s=this;return D(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(c){return s.receiveSingle(c,t)}))];case 1:return r=n.sent().filter(G),r.length===1?[2,r[0]]:r.length?[2,r]:[2,null]}})})},i.prototype.receiveSingle=function(e,t){return x(this,void 0,void 0,function(){var r,s;return D(this,function(n){switch(n.label){case 0:return r=this.nameToMethodDictionary[e.method],(0,y.isJSONRPCRequest)(e)?[3,1]:[2,H(e)];case 1:return[4,this.callMethod(r,e,t)];case 2:return s=n.sent(),[2,X(e,s)]}})})},i.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.middleware?this.middleware=this.combineMiddlewares(W([this.middleware],e,!0)):this.middleware=this.combineMiddlewares(e)},i.prototype.combineMiddlewares=function(e){return e.length?e.reduce(this.middlewareReducer):null},i.prototype.middlewareReducer=function(e,t){return function(r,s,n){return e(function(c,a){return t(r,c,a)},s,n)}},i.prototype.callMethod=function(e,t,r){var s=this,n=function(a,d){return e?e(a,d):a.id!==void 0?Promise.resolve(Q(a.id)):Promise.resolve(null)},c=function(a){return s.errorListener('An unexpected error occurred while executing "'.concat(t.method,'" JSON-RPC method:'),a),Promise.resolve(s.mapErrorToJSONRPCErrorResponseIfNecessary(t.id,a))};try{return(this.middleware||K)(n,t,r).then(void 0,c)}catch(a){return c(a)}},i.prototype.mapErrorToJSONRPCErrorResponseIfNecessary=function(e,t){return e!==void 0?this.mapErrorToJSONRPCErrorResponse(e,t):null},i}();_.JSONRPCServer=z;var G=function(i){return i!==null},K=function(i,e,t){return i(e,t)},U=function(i,e){return i!==void 0?(0,y.createJSONRPCSuccessResponse)(i,e):null},V=function(i,e){var t,r=(t=e==null?void 0:e.message)!==null&&t!==void 0?t:"An unexpected error occurred",s=L.DefaultErrorCode,n;return e instanceof y.JSONRPCErrorException&&(s=e.code,n=e.data),(0,y.createJSONRPCErrorResponse)(i,s,r,n)},X=function(i,e){return e||(i.id!==void 0?(0,y.createJSONRPCErrorResponse)(i.id,y.JSONRPCErrorCode.InternalError,"Internal error"):null)},E={},Y=h&&h.__awaiter||function(i,e,t,r){function s(n){return n instanceof t?n:new t(function(c){c(n)})}return new(t||(t=Promise))(function(n,c){function a(l){try{o(r.next(l))}catch(p){c(p)}}function d(l){try{o(r.throw(l))}catch(p){c(p)}}function o(l){l.done?n(l.value):s(l.value).then(a,d)}o((r=r.apply(i,e||[])).next())})},Z=h&&h.__generator||function(i,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,s,n,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(o){return function(l){return d([o,l])}}function d(o){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,o[0]&&(t=0)),t;)try{if(r=1,s&&(n=o[0]&2?s.return:o[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,o[1])).done)return n;switch(s=0,n&&(o=[o[0]&2,n.value]),o[0]){case 0:case 1:n=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,s=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){t.label=o[1];break}if(o[0]===6&&t.label<n[1]){t.label=n[1],n=o;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(o);break}n[2]&&t.ops.pop(),t.trys.pop();continue}o=e.call(i,t)}catch(l){o=[6,l],s=0}finally{r=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(E,"__esModule",{value:!0});E.JSONRPCServerAndClient=void 0;var O=S,$=function(){function i(e,t,r){r===void 0&&(r={});var s;this.server=e,this.client=t,this.errorListener=(s=r.errorListener)!==null&&s!==void 0?s:console.warn}return i.prototype.applyServerMiddleware=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];(e=this.server).applyMiddleware.apply(e,t)},i.prototype.hasMethod=function(e){return this.server.hasMethod(e)},i.prototype.addMethod=function(e,t){this.server.addMethod(e,t)},i.prototype.addMethodAdvanced=function(e,t){this.server.addMethodAdvanced(e,t)},i.prototype.removeMethod=function(e){this.server.removeMethod(e)},i.prototype.timeout=function(e){return this.client.timeout(e)},i.prototype.request=function(e,t,r){return this.client.request(e,t,r)},i.prototype.requestAdvanced=function(e,t){return this.client.requestAdvanced(e,t)},i.prototype.notify=function(e,t,r){this.client.notify(e,t,r)},i.prototype.rejectAllPendingRequests=function(e){this.client.rejectAllPendingRequests(e)},i.prototype.receiveAndSend=function(e,t,r){return Y(this,void 0,void 0,function(){var s,n;return Z(this,function(c){switch(c.label){case 0:return(0,O.isJSONRPCResponse)(e)||(0,O.isJSONRPCResponses)(e)?(this.client.receive(e),[3,4]):[3,1];case 1:return(0,O.isJSONRPCRequest)(e)||(0,O.isJSONRPCRequests)(e)?[4,this.server.receive(e,t)]:[3,3];case 2:return s=c.sent(),s?[2,this.client.send(s,r)]:[3,4];case 3:return n="Received an invalid JSON-RPC message",this.errorListener(n,e),[2,Promise.reject(new Error(n))];case 4:return[2]}})})},i}();E.JSONRPCServerAndClient=$;(function(i){var e=h&&h.__createBinding||(Object.create?function(r,s,n,c){c===void 0&&(c=n);var a=Object.getOwnPropertyDescriptor(s,n);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[n]}}),Object.defineProperty(r,c,a)}:function(r,s,n,c){c===void 0&&(c=n),r[c]=s[n]}),t=h&&h.__exportStar||function(r,s){for(var n in r)n!=="default"&&!Object.prototype.hasOwnProperty.call(s,n)&&e(s,r,n)};Object.defineProperty(i,"__esModule",{value:!0}),t(J,i),t(j,i),t(S,i),t(_,i),t(E,i)})(T);class ee{constructor(){this.listeners=new Map,this.messageQueue=[],this.connected=!1,this.reconnectionAttempts=0,this.maxReconnectionAttempts=10,this.maxReconnectionDelay=3e4,this.client=new T.JSONRPCClient(e=>!this.ws||this.ws.readyState!==WebSocket.OPEN?(this.messageQueue.push(e),Promise.reject(new Error("WebSocket not connected"))):(this.ws.send(JSON.stringify(e)),Promise.resolve(void 0))),this.connect()}connect(){const e=window.location.protocol==="https:"?"wss:":"ws:",t=window.location.host,r=`${e}//${t}/ipc`;console.log("[IPCRenderer] Connecting to:",r),this.ws=new WebSocket(r),this.ws.onopen=()=>{for(console.log("[IPCRenderer] WebSocket connected"),this.connected=!0,this.reconnectionAttempts=0;this.messageQueue.length>0;){const s=this.messageQueue.shift();this.ws.send(JSON.stringify(s))}},this.ws.onmessage=s=>{try{const n=JSON.parse(s.data);if(!("id"in n)&&n.method){this.handleNotification(n.method,n.params||[]);return}this.client.receive(n)}catch(n){console.error("[IPCRenderer] Error parsing message:",n)}},this.ws.onclose=()=>{console.log("[IPCRenderer] WebSocket disconnected"),this.connected=!1,this.reconnect()},this.ws.onerror=s=>{console.error("[IPCRenderer] WebSocket error:",s)}}reconnect(){if(this.reconnectionAttempts>=this.maxReconnectionAttempts){console.error("[IPCRenderer] Max reconnection attempts reached");return}const e=Math.min(1e3*Math.pow(2,this.reconnectionAttempts),this.maxReconnectionDelay);console.log(`[IPCRenderer] Reconnecting in ${e}ms (attempt ${this.reconnectionAttempts+1})`),this.reconnectionTimer=setTimeout(()=>{this.reconnectionAttempts++,this.connect()},e)}handleNotification(e,t){const r=this.listeners.get(e);if(!r||r.size===0)return;const s={sender:{id:"main"}};for(const n of r)try{n(s,...t)}catch(c){console.error(`[IPCRenderer] Error in listener for ${e}:`,c)}}async invoke(e,...t){try{return await this.client.request(e,t)}catch(r){throw console.error(`[IPCRenderer] Failed to invoke ${e}:`,r),r}}send(e,...t){const r={jsonrpc:"2.0",method:e,params:t};this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(r)):this.messageQueue.push(r)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),this}once(e,t){const r=(s,...n)=>{this.removeListener(e,r),t(s,...n)};return this.on(e,r)}removeListener(e,t){const r=this.listeners.get(e);return r&&(r.delete(t),r.size===0&&this.listeners.delete(e)),this}removeAllListeners(e){return e?this.listeners.delete(e):this.listeners.clear(),this}isConnected(){return this.connected}enableDebug(){const e=this.client.request.bind(this.client);this.client.request=async(r,s)=>{console.log("[IPCRenderer] Request:",r,s);const n=await e(r,s);return console.log("[IPCRenderer] Response:",r,n),n};const t=this.send.bind(this);this.send=(r,...s)=>{console.log("[IPCRenderer] Send:",r,s),t(r,...s)}}disconnect(){this.reconnectionTimer&&clearTimeout(this.reconnectionTimer),this.ws&&(this.ws.close(),this.ws=void 0),this.connected=!1}}const w=new ee;class te{async showOpenDialog(e={}){return"showOpenFilePicker"in window?await this.showOpenDialogModern(e):await this.showOpenDialogFallback(e)}async showOpenDialogModern(e){var t,r;try{const s=(t=e.properties)==null?void 0:t.includes("openDirectory"),n=(r=e.properties)==null?void 0:r.includes("multiSelections");if(s)return{canceled:!1,filePaths:[(await window.showDirectoryPicker({startIn:e.defaultPath})).name]};{const c={multiple:n,startIn:e.defaultPath};e.filters&&e.filters.length>0&&(c.types=e.filters.map(o=>({description:o.name,accept:{"*/*":o.extensions.map(l=>`.${l}`)}})));const a=await window.showOpenFilePicker(c);return{canceled:!1,filePaths:await Promise.all(a.map(async o=>(await o.getFile()).name))}}}catch{return{canceled:!0,filePaths:[]}}}async showOpenDialogFallback(e){return new Promise(t=>{var s,n;const r=document.createElement("input");if(r.type="file",r.style.display="none",(s=e.properties)!=null&&s.includes("multiSelections")&&(r.multiple=!0),(n=e.properties)!=null&&n.includes("openDirectory")&&(r.webkitdirectory=!0),e.filters&&e.filters.length>0){const c=e.filters.flatMap(a=>a.extensions.map(d=>`.${d}`));r.accept=c.join(",")}r.onchange=()=>{if(r.files&&r.files.length>0){const c=Array.from(r.files).map(a=>a.name);t({canceled:!1,filePaths:c})}else t({canceled:!0,filePaths:[]});document.body.removeChild(r)},r.oncancel=()=>{t({canceled:!0,filePaths:[]}),document.body.removeChild(r)},document.body.appendChild(r),r.click()})}async showSaveDialog(e={}){var r;if("showSaveFilePicker"in window)try{const s={suggestedName:((r=e.defaultPath)==null?void 0:r.split("/").pop())||"untitled"};return e.filters&&e.filters.length>0&&(s.types=e.filters.map(a=>({description:a.name,accept:{"*/*":a.extensions.map(d=>`.${d}`)}}))),{canceled:!1,filePath:(await(await window.showSaveFilePicker(s)).getFile()).name}}catch{return{canceled:!0}}const t=prompt(e.message||"Enter filename:",e.defaultPath||"untitled");return t?{canceled:!1,filePath:t}:{canceled:!0}}async showMessageBox(e){const t=e.buttons||["OK"],r=`${e.title?e.title+`

`:""}${e.message}${e.detail?`

`+e.detail:""}`;return t.length===1?(alert(r),{response:0,checkboxChecked:e.checkboxChecked}):t.length===2&&t.includes("OK")&&t.includes("Cancel")?{response:confirm(r)?t.indexOf("OK"):t.indexOf("Cancel"),checkboxChecked:e.checkboxChecked}:await this.showCustomMessageBox(e)}async showCustomMessageBox(e){return new Promise(t=>{const r=document.createElement("div");r.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      `;const s=document.createElement("div");if(s.style.cssText=`
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 500px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      `,e.title){const o=document.createElement("h3");o.textContent=e.title,o.style.marginTop="0",s.appendChild(o)}const n=document.createElement("p");if(n.textContent=e.message,s.appendChild(n),e.detail){const o=document.createElement("p");o.textContent=e.detail,o.style.color="#666",o.style.fontSize="14px",s.appendChild(o)}let c=null;if(e.checkboxLabel){const o=document.createElement("label");o.style.display="block",o.style.marginTop="10px",c=document.createElement("input"),c.type="checkbox",c.checked=e.checkboxChecked||!1,c.style.marginRight="8px",o.appendChild(c),o.appendChild(document.createTextNode(e.checkboxLabel)),s.appendChild(o)}const a=document.createElement("div");a.style.cssText="margin-top: 20px; text-align: right;",(e.buttons||["OK"]).forEach((o,l)=>{const p=document.createElement("button");p.textContent=o,p.style.cssText=`
          margin-left: 8px;
          padding: 8px 16px;
          border: 1px solid #ccc;
          border-radius: 4px;
          background: ${l===e.defaultId?"#007bff":"white"};
          color: ${l===e.defaultId?"white":"black"};
          cursor: pointer;
        `,p.onclick=()=>{document.body.removeChild(r),t({response:l,checkboxChecked:c==null?void 0:c.checked})},a.appendChild(p)}),s.appendChild(a),r.appendChild(s),document.body.appendChild(r)})}showErrorBox(e,t){alert(`${e}

${t}`)}}const ne=new te,b=new Map;window.snippetAPI={getAllSnippets:()=>w.invoke("snippets:getAll"),getSnippet:i=>w.invoke("snippets:get",i),saveSnippet:i=>w.invoke("snippets:save",i),deleteSnippet:i=>w.invoke("snippets:delete",i),exportSnippet:async(i,e)=>{try{const t=b.get(e);if(!t)return{success:!1,error:"File handle not found"};const r={title:i.title,language:i.language,code:i.code,description:i.description||"",tags:i.tags||[],exportedAt:new Date().toISOString()},s=await t.createWritable();return await s.write(JSON.stringify(r,null,2)),await s.close(),"Notification"in window&&Notification.permission==="granted"&&new Notification("Snippet Exported",{body:`Exported to ${e}`}),{success:!0}}catch(t){return{success:!1,error:t.message}}},importSnippet:async i=>{try{const e=b.get(i);if(!e)return{success:!1,error:"File handle not found"};const r=await(await e.getFile()).text(),s=JSON.parse(r),n={title:s.title||"Imported Snippet",language:s.language||"text",code:s.code||"",description:s.description||"",tags:s.tags||[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},c=await w.invoke("snippets:save",n);return c.success&&"Notification"in window&&Notification.permission==="granted"&&new Notification("Snippet Imported",{body:`"${n.title}" imported successfully`}),c}catch(e){return{success:!1,error:e.message}}},copyToClipboard:i=>w.invoke("clipboard:writeText",i),readFromClipboard:()=>w.invoke("clipboard:readText"),openSnippetsFolder:()=>w.invoke("shell:openSnippetsFolder"),openExternal:i=>w.invoke("shell:openExternal",i),openFolderDialog:async()=>{const i=await ne.showOpenDialog({title:"Select Folder to Import Snippets",properties:["openDirectory"]});return i.canceled?{success:!1,canceled:!0}:{success:!0,folderPath:i.filePaths[0]}},openFileDialog:async()=>{try{const i=await window.showOpenFilePicker({types:[{description:"JSON Files",accept:{"*/*":[".json"]}}],multiple:!0});return{success:!0,filePaths:await Promise.all(i.map(async t=>{const r=await t.getFile();return b.set(r.name,t),r.name}))}}catch{return{success:!1,canceled:!0}}},saveFileDialog:async i=>{try{const e=await window.showSaveFilePicker({suggestedName:i||"snippet.json",types:[{description:"JSON Files",accept:{"*/*":[".json"]}}]}),t=await e.getFile();return b.set(t.name,e),{success:!0,filePath:t.name}}catch{return{success:!1,canceled:!0}}},getAppInfo:()=>w.invoke("app:getInfo")};console.log("âœ… Snippet API ready!",window.snippetAPI);window.dispatchEvent(new Event("snippetAPIReady"));
